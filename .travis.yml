# see http://about.travis-ci.org/docs/user/languages/php/ for more hints
language: php

# The platforms you wants to test on
dist: trusty
os:
  - linux

# list any PHP version you want to test against
php:
  # using major version aliases

  # aliased to a recent 5.5.x version
  #- 5.5
  # aliased to a recent 5.6.x version
  # - 5.6
  # aliased to a recent 7.x version
  - 7.0

#services:
#  - mysql

# optionally specify a list of environments, for example to test different RDBMS
env:
  - DB=mysql

# Dont need the extra depth
git:
  depth: 3

# optionally set up exclutions and allowed failures in the matrix
#matrix:
#  allow_failures:
#    - php: 7.0

# faster builds on new travis setup not using sudo
sudo: false

# Cache folder, you can delete cache from Travis CI web interface
# cache:
#   directories:
#     - vendor
#     - $HOME/.composer/cache

# Disable x-debug to speed up things
before_install:
  - phpenv config-rm xdebug.ini
   - >
     touch config.php; printf '<?php $databaseServer=\"127.0.0.1\"; $databaseUsername=\"root\"; $databasePassword=\"\"; $databaseName=\"gibbon_test\"; $guid=\"testing\"; $caching=1;' > config.php;
  # - >
  #   touch composer.json; printf '{\"require-dev\": {\"codeception/codeception\": \"^2.1\"}}' > composer.json;

# Install packages those will be required during build
# install:
#   - travis_retry composer self-update
#   - travis_retry composer global require "phpunit/phpunit:5.7.*@dev"
#   - travis_retry composer global require "codeception/codeception:2.1.*@dev"
#   - travis_retry composer install --prefer-dist

# execute any number of scripts before the test run, custom env's are available as variables
before_script:
  - mysql -e "create database IF NOT EXISTS gibbon_test;" -uroot;
  - mysql -uroot gibbon_test < gibbon.sql;
  - mysql -uroot gibbon_test < gibbon_demo.sql;
  - mysql -uroot gibbon_test < tests/config/data/install.sql;
  - cd tests

# omitting "script:" will default to phpunit
# use the $DB env variable to determine the phpunit.xml to use
script:
  - which php
  - which mysql
  - which phpunit
  - phpunit --version
  - phpunit --verbose --configuration phpunit.xml
  # - ~/.composer/vendor/bin/codecept run

#after_script:

#after_success:

#after_failure:

# Tell Travis CI to monitor only 'Travis_CI' branch (for now)
branches:
 only: feature/Travis_CI

# configure notifications (email, IRC, campfire etc)
notifications:
  email: "sandra.kuipers@tis.edu.mo"
