{#<!--
Gibbon: the flexible, open school platform
Founded by Ross Parker at ICHK Secondary. Built by Ross Parker, Sandra Kuipers and the Gibbon community (https://gibbonedu.org/about/)
Copyright © 2010, Gibbon Foundation
Gibbon™, Gibbon Education Ltd. (Hong Kong)

This is a Gibbon template file, written in HTML and Twig syntax.
For info about editing, see: https://twig.symfony.com/doc/2.x/
-->#}

{% set timeRange = structure.getTimeRange %}
{% set dateRange = structure.getDateRange %}

{% set now = structure.getToday.format('H:i:s') %}

<div id="timetable" name='tt' x-data='{ ttDate: "", ttID: "{{ gibbonTTID }}", ttRefresh: false, ttPopup: false, ttActiveDay: "{{ structure.getToday.format('D')|default('Mon') }}" }' @ttpopup.window="ttPopup = false">

    

    <div x-data="{{ layersToggle }}" class="relative" >

        <!-- <div  class="z-20 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-2/5">
            <div x-show="ttPopup" x-transition @click.outside="ttPopup = false" class="flex flex-col justify-between bg-white border rounded-lg shadow-xl min-h-64">
                
                <div class="flex justify-between p-4 gap-2">
                    <div>
                        Title
                    </div>
                    <button @click="ttPopup = false">
                        {{ icon('basic', 'cross', 'size-5 text-gray-600') }}
                    </button>
                </div>

                <div class="flex-1 text-left px-4">
                    Foo
                </div>

                <div class="text-left p-4 border-t">
                    Foo
                </div>
                
            </div>
            
        </div> -->

    {{ include('ui/timetableNav.twig.html') }}

    <div class="flex flex-row gap-2 xl:gap-3 w-full">
        <div class="w-12 flex-col content-center justify-center">
            <span class="block text-xxs text-gray-600">{{ __('Week') }} {{ structure.getCurrentDate.format('W') }}</span>
        </div>

        {% for day in structure.getWeekdays %}

        {% set timetableDay = structure.getTimetableDay(day.date) %}

        <div class="flex-1">
            <button @click="ttActiveDay = '{{ day.nameShort }}';" class="flex w-full items-center justify-center md:justify-between leading-none py-2 px-3 rounded-t border text-gray-700" :class="{'font-bold md:font-normal bg-white border-gray-400 md:bg-gray-100 ': ttActiveDay == '{{ day.nameShort }}', 'font-normal bg-gray-100 border-gray-200 md:border-gray-400': ttActiveDay != '{{ day.nameShort }}'}" 
                {%if timetableDay.color %} style="background-color: {{ timetableDay.color }}; color: {{ timetableDay.fontColor }};" {% endif %}
            >
                <span class="text-xs">
                    {{ timetableDay.nameShort and timetableDay.nameShortDisplay == "Timetable Day Short Name" ? timetableDay.nameShort : day.nameShort }}
                </span>
                <span class="hidden md:inline-block text-base font-bold">{{ day.date|date('d') }}</span>
            </button>
    
        </div>
    
        {% endfor %}
    </div>
    
    <div class="flex flex-row gap-2 xl:gap-3 w-full">
    
        <div class="w-12 mb-2">
            <span class="inline-block text-xxs text-gray-600">{{ __('All Day Events') }}</span>
        </div>

        {% for day in structure.getWeekdays %}
        <div class="flex-1 flex-col border-r border-l pb-1" :class="{'flex': ttActiveDay == '{{ day.nameShort }}', 'hidden md:flex': ttActiveDay != '{{ day.nameShort }}'}">
    
            {% for layer in layers %}
                {% for item in layer.getItemsByDate(day.date|date('Y-m-d'), true) %}
                    <div class="relative" style="top: {{ structure.timeToPixels(item.timeStart) }}px">
                    {{ include('ui/timetableItem.twig.html') }}
                    </div>
                {% endfor %}
            {% endfor %}
    
        </div>
        {% endfor %}
    </div>
        
    <div class="relative flex flex-row gap-2 xl:gap-3 w-full">
    
        {% if structure.isCurrentWeek and timeRange.getStartDate.format('H:i:s') <= now and timeRange.getEndDate.format('H:i:s') >= now %}
        <div class="z-10 absolute ml-1 w-full left-0" style="top: {{ structure.timeToPixels(now) }}px">
            <!-- <div class="border-b border-blue-500 w-full"></div> -->
            <div class="absolute origin-center left-0 -mt-3 rounded-full border border-blue-500 bg-blue-500 w-10 shadow">
                <span class="inline-block text-xxs text-white uppercase leading-loose">{{ structure.getToday.format('G:i') }}</span>
            </div>
            <!-- <div class="absolute origin-center w-1.5 h-1.5 right-0 -mr-1 -mt-1 rounded-full bg-blue-500 shadow">
            </div> -->
        </div>
        {% endif %}

        <div class="w-12">
            {% for time in timeRange %}
            <div class="leading-none" style="height: {{ structure.minutesToPixels(60) }}px">
                <span class="block text-xxs text-gray-500 uppercase">{{ time.format('G:i') }}</span>
            </div>
            {% endfor %}
        </div>

        {% for day in structure.getWeekdays %}
            {{ include('ui/timetableDay.twig.html') }}
        {% endfor %}
    </div>

    </div>
</div>
   
<!-- <script>
htmx.onLoad(function (content) {
    $('.ttItem').draggable({
        containment: '#timetable',
        revert: true,
        zIndex: 50,
        cursor: 'move',
    });
});
</script> -->
