{#<!--
Gibbon, Flexible & Open School System
Copyright (C) 2010, Ross Parker

This is a Gibbon template file, written in HTML and Twig syntax.
For info about editing, see: https://twig.symfony.com/doc/2.x/

Main Menu: Displays the top-level categories and active modules.
-->#}

<ul class="list-none flex flex-wrap items-center m-0 px-2 border-t border-b">
    <li class="pl-2 mt-1">
        <a class="block uppercase font-bold text-sm text-gray-800 hover:text-purple-500 no-underline px-2 py-3" href="{{ absoluteURL }}/index.php">{{ __('Home') }}</a>
    </li>

    {% if isLoggedIn %}
        {% for categoryName, items in menuMain  %}
        <li class="sm:relative group mt-1">
            <a class="block uppercase font-bold text-sm text-gray-800 hover:text-purple-500 no-underline px-2 py-3" href="#">{{ __(categoryName) }}</a>

            <ul class="list-none bg-transparent-900 absolute hidden group-hover:block w-full sm:w-48 left-0 m-0 -mt-1 py-1 sm:p-1 z-50">
                {% for item in items %}
                <li class="hover:bg-purple-700">
                    <a class="block text-sm text-white focus:text-purple-200 text-left no-underline px-1 py-2 md:py-1 leading-normal" href="{{ item.url }}">{{ __(item.name, item.textDomain) }}</a>
                </li>
                {% endfor %}
            </ul>
        </li>
        {% endfor %}
    {% endif %}

    <li class="notificationTray self-end flex-grow">
        <div class="flex flex-row-reverse mb-1">

            {% if statusTray.messageWall %}
                <div id="messageWall" class="relative">
                    {% if statusTray.messageWall.messages > 0 %}
                        <a class="inactive inline-block relative mr-4" title="{{ __('Message Wall') }}" href="{{ statusTray.messageWall.url }}">
                            <span class='badge -mr-2 right-0'>{{ statusTray.messageWall.messages }}</span>
                            <img class="minorLinkIcon" style="margin-left: 4px; vertical-align: -75%" src="{{ absoluteURL }}/themes/{{ gibbonThemeName }}/img/messageWall.png">
                        </a>
                    {% else %}
                        <a class="inactive inline-block relative mr-4" title="{{ __('Message Wall') }}" href="{{ statusTray.messageWall.url }}">
                            <img class="minorLinkIcon" style="margin-left: 4px; opacity: 0.2; vertical-align: -75%" src="{{ absoluteURL }}/themes/{{ gibbonThemeName }}/img/messageWall.png">
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        
            {% if statusTray.notifications %}
                <div id='notifications'>
                    {% if statusTray.notifications.count > 0 %}
                        <a class="inactive inline-block relative mr-4" title="{{ __('Notifications') }}" href="{{ statusTray.notifications.url }}">
                            <span class='notificationCounter badge -mr-2 right-0'>{{ statusTray.notifications.count }}</span>
                            <img class="minorLinkIcon" style="margin-left: 4px; vertical-align: -75%" src="{{ absoluteURL }}/themes/{{ gibbonThemeName }}/img/notifications.png">
                        </a>
                    {% else %}
                        <a class="inactive inline-block relative mr-4" title="{{ __('Notifications') }}" href="{{ statusTray.notifications.url }}">
                            <img class="minorLinkIcon" style="margin-left: 4px; opacity: 0.2; vertical-align: -75%" src="{{ absoluteURL }}/themes/{{ gibbonThemeName }}/img/notifications.png">
                        </a>
                    {% endif %}
        
                    <script type="text/javascript">
                        $(document).ready(function() {
                            setInterval(function() {
                                refreshNotifications();
                            }, {{ statusTray.notifications.interval }});
                        });
                    </script>
                </div>
            {% endif %}
        
            {% if statusTray.alarm %}
                <script>
                    $(document).ready(function() {
                        refreshNotifications();
                    }) ;
                </script>
            {% endif %}
        </div>
    </li>

    <script>
        function refreshNotifications() {
            $.ajax({
                url: "index_notification_ajax.php",
                dataType: "json",
                success: function(data) {
                    console.log(data);
                    if (data.count > 0) {
                        $("#notifications .notificationCounter").removeClass('hidden').html(data.count);
                        $("#notifications").removeClass('opacity-25');
                    } else {
                        $("#notifications .notificationCounter").html('').addClass('hidden');
                        $("#notifications").addClass('opacity-25');
                    }
    
                    if (data.alarm != false) {
                        if ($('#TB_window').is(':visible') == true && $('#TB_window').hasClass('alarm') == false) {
                            $("#TB_window").remove();
                            $("body").append("<div id='TB_window'></div>");
                        }
                        if ($('#TB_window').is(':visible') == false) {
                            var url = '{{ absoluteURL }}/index_notification_ajax_alarm.php?type='+ data.alarm +'&KeepThis=true&TB_iframe=true&width=1000&height=500';
                            tb_show('', url);
                            $('#TB_window').addClass('alarm') ;
                        }
                    } else {
                        if ($('#TB_window').is(':visible')==true && $('#TB_window').hasClass('alarm') ) {
                            tb_remove();
                        }
                    }
                }
            });
        }
    </script>
</ul>


