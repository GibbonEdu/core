{#<!--
Gibbon, Flexible & Open School System
Copyright (C) 2010, Ross Parker

This is a Gibbon template file, written in HTML and Twig syntax.
For info about editing, see: https://twig.symfony.com/doc/2.x/
-->#}

{% extends "components/dataTable.twig.html" %}

{% block table %}
    <div class="relative">
        <div id="{{ table.getID }}">
            <div class="dataTable" data-results="{{ dataSet.getResultCount }}">
                {{ parent() }}
            </div>
        </div>

        {{ block('bulkActions') }}
    </div>

    <script>
    $(function(){
        $('#{{ table.getID }}').gibbonDataTable( '{{ path|raw }}', {{ jsonData|raw }}, '{{ identifier }}');
    });
    </script>
{% endblock table %}


{% block header %}
    <div class="flex items-end justify-between">
        <div class="flex items-end pb-2 {{ dataSet.getTotalCount > 0 ? 'h-10' : '' }}">
            {{ block('pageCount') }}
        </div>

        {{ parent() }}
    </div>

    {% if dataSet.getTotalCount > 0 and not hidePagination %}
    <div class="flex flex-wrap sm:flex-no-wrap items-stretch justify-between">
        <div class="flex items-stretch h-full">
            {% if pageSize %}
            <div class="relative -mr-1 mb-2">
                <div class="absolute caret z-10 mt-3 right-0 mr-5 pointer-events-none"></div>
                {{ pageSize|raw }}
            </div>
            {% endif %}

            {% if filterOptions %}
            <div class="relative mb-2">
                <div class="absolute caret z-10 mt-3 right-0 mr-5 pointer-events-none"></div>
                {{ filterOptions|raw }}
            </div>
            {% endif %}
            
            {% if filterCriteria and filterOptions %}
            <nav class="flex cursor-default mb-2">
                {{ block('filters') }}
            </nav>
            {% endif %}
        </div>

        {% if listOptions %}
            {{ include('components/listOptions.twig.html') }}
        {% endif %}

        {{ block('pagination') }}
    </div>
    {% endif %}
{% endblock header %}


{% block footer %}
    {% if dataSet.getResultCount > dataSet.getPageSize %}
    <div class="flex flex-col sm:flex-row sm:items-end justify-end mt-2">
        {{ block('pagination') }}
    </div>
    {% endif %}
{% endblock footer %}


{% block filters %}
    {% for name, label in filterCriteria %}
        <button type="button" class="filter -mx-px py-2 px-3 border border-blue-700 bg-blue-500 hover:bg-blue-700 z-10 text-white font-bold" data-filter="{{ name }}">
            {{ label|raw }}
        </button>
    {% endfor %}
    
    <button type="button" class="filter p-2 rounded-r border border-gray-500 text-gray-600 bg-gray-200 font-bold hover:bg-gray-400 clear">
        {{ __('Clear') }}
    </button>

{% endblock filters %}


{% block pageCount %}
    {% if dataSet.getTotalCount > 0 %}
    <div class="text-xs">
        {{ searchText ? __('Search') ~ " " }}

        {{ dataSet.isSubset ? __('Results') : __('Records') }}

        {% if dataSet.count > 0 %}
            {{ dataSet.getPageFrom }}-{{ dataSet.getPageTo }} {{ __('of') }}
        {% endif %} 
        
        {{ dataSet.getResultCount|number_format }}
    </div>
    {% endif %}
{% endblock pageCount %}


{% block pagination %}
    
    {% set buttonStyle = 'border -ml-px px-2 py-1 font-bold leading-loose' %}
    
    {% if dataSet.getResultCount > dataSet.getPageSize or filterOptions %}
    <div class="pagination mb-2 ml-2">
        <button type="button" class="paginate rounded-l text-gray-600 bg-gray-200 border-gray-500 {{ not dataSet.isFirstPage ? 'hover:bg-gray-400'}} {{ buttonStyle }}" data-page="{{ dataSet.getPrevPageNumber }}" {{ dataSet.isFirstPage ? 'disabled'}}>
            {{ __('Prev') }}
        </button>

        {%- for page in dataSet.getPaginatedRange -%}
            {%- if page == '...' -%}
                <button type="button" class=" {{ buttonStyle }}" disabled>...</button>
            {%- else -%}
                <button type="button" class="paginate {{ buttonStyle }} {{ page == dataSet.getPage ? 'bg-blue-500 border-blue-700 text-white relative z-10' : 'text-gray-600 hover:bg-gray-400 border-gray-500' }}" data-page="{{ page }}">{{ page }}</button>
            {%- endif -%}
        {%- endfor -%}

        <button type="button" class="paginate rounded-r text-gray-600 border-gray-500 {{ not dataSet.isLastPage ? 'hover:bg-gray-400'}} {{ buttonStyle }}" data-page="{{ dataSet.getNextPageNumber }}" {{ dataSet.isLastPage ? 'disabled'}}>
        {{ __('Next') }}
        </button>
    </div>
    {% endif %}
    
{% endblock pagination %}


{% block bulkActions %}
    {% if bulkActions %}
    <div class="bulkActionPanel hidden absolute top-0 right-0 w-full flex items-center justify-between p-1 pt-2 bg-purple-600 rounded-t z-20">
        <div class="bulkActionCount flex-grow text-white text-sm text-right pr-3">
            <span>0</span> {{ __('Selected') }}
        </div>
        
        {{ bulkActions.getOutput|raw }}

        <script>
            {{ bulkActions.getValidationOutput|raw }}
        </script>
    </div>
    {% endif %}
{% endblock bulkActions %}

