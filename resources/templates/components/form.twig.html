{#<!--
Gibbon: the flexible, open school platform
Founded by Ross Parker at ICHK Secondary. Built by Ross Parker, Sandra Kuipers and the Gibbon community (https://gibbonedu.org/about/)
Copyright © 2010, Gibbon Foundation
Gibbon™, Gibbon Education Ltd. (Hong Kong)

This is a Gibbon template file, written in HTML and Twig syntax.
For info about editing, see: https://twig.symfony.com/doc/2.x/
-->#}

{% if form.getAction != 'ajax' %}
<form {{ form.getAttributeString|raw }} onsubmit="gibbonFormSubmitted(this)">
{% endif %}

    {% set newLayout = "standardForm" in form.getClass and "blank" not in form.getClass %}
    {% set metaSidebar = "standardForm" in form.getClass and "noIntBorder" not in form.getClass %}

    {% if form.hasPages %}
        <ul class="multiPartForm my-6">
            {% for page in form.getPages %}
            <li class="step {{ page.number <= form.getCurrentPage ? 'active' : '' }}">
                {% if page.url and page.number <= form.getMaxPage and page.number != form.getCurrentPage %}
                    <a href="{{ page.url }}" class="-mt-10 pt-10 text-gray-800 hover:text-purple-600 hover:underline">
                {% endif %}
                {{- page.name -}}
                {% if page.url and page.number <= form.getMaxPage and page.number != form.getCurrentPage %}
                    </a>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if form.getTitle and not form.getHeader %}
        <h2>{{ form.getTitle }}</h2>
    {% endif %}

    {% if form.getDescription %}
        <p>{{ form.getDescription|raw }}</p>
    {% endif %}

    {% if introduction %}
        <p>{{ introduction|raw }}</p>
    {% endif %}

    {% block header %}
        <header class="relative flex justify-between {{ newLayout ? '' }}">
            {% if form.getHeader %}
                <h2>{{ form.getTitle }}</h2>
                <div class="linkTop flex justify-end gap-2">
                    {% for action in form.getHeader %}
                        {{ action.getOutput|raw }}
                    {% endfor %}
                </div>
            {% endif %}
        </header>
    {% endblock header %}

    {% for values in form.getHiddenValues %}
        <input type="hidden" name="{{ values.name }}" value="{{ values.value }}">
    {% endfor %}

    {% set renderStyle = "standardForm" in form.getClass or "noIntBorder" in form.getClass and "blank" not in form.getClass ? 'flex' : 'table' %}


    {% if form.getRows|length > 0 %}
    <section class="w-full grid grid-cols-5 2xl:grid-cols-8 gap-2 sm:gap-4 font-sans text-xs text-gray-700  " style="" cellspacing="0">

        <div class="{{ newLayout and metaSidebar ? 'col-span-6' : 'col-span-8' }}">
        {% for section, rows in form.getRowsByHeading %}
            {% set sectionLoop = loop %}
            
            {% if "sticky" not in (rows|first).class and "blank" not in form.getClass %}
            <div class="{{ ((rows|first).getElements|first).class }} mb-6 border rounded border-gray-400 {{ not sectionLoop.last ? 'border-t-4 focus-within:border-t-blue-500 transition' }} {{ "noIntBorder" in form.getClass ? 'bg-blue-50 p-4' : 'bg-gray-50' }}  {{ newLayout ? 'px-4 py-2 sm:py-3 sm:px-8' : ''}}" >
            {% endif %}

            {% for num, row in rows %}

                {% set rowLoop = loop %}
                {% if true or renderStyle == 'flex' %}
                    {% set rowClass = 'flex flex-col sm:flex-row justify-between sm:items-start content-center p-0' %}
                {% endif %}

                {% set firstElement = (row.getElements|first) %}
                {% if firstElement.isInstanceOf('Gibbon\\Forms\\Layout\\Heading') and firstElement.getTag == 'h3' %}
                    {% set rowClass = "blank" not in form.getClass ? rowClass ~ ' ' : rowClass ~ ' ' %}
                {% endif %}


                <div id="{{ row.getID }}" class="{{ newLayout ? ' py-4' : 'p-2' }} gap-2 sm:gap-4 {{ row.getClass|replace({'standardWidth': ''}) }} {{ rowClass }}  " {{ row.getAttributeString("data-drag-id")|raw }}>

                {% if "draggableRow" in row.getClass %}
                    <div class="drag-handle w-2 h-6 ml-2 px-px border-4 border-dotted cursor-move"></div>
                {% endif %}
        
                {% for element in row.getElements %}
                    {% set colspan = loop.last and loop.length < totalColumns ? (totalColumns + 1 - loop.length) : 0  %}

                    {% if element.isInstanceOf('Gibbon\\Forms\\Layout\\Heading') %}
                        {% set class = 'flex-grow justify-center' %}
                    {% elseif element.isInstanceOf('Gibbon\\Forms\\Layout\\Label') %}
                        {% set class = 'w-full sm:w-2/5 flex flex-col justify-center sm:mb-0' %}
                    {% elseif element.isInstanceOf('Gibbon\\Forms\\Layout\\Column')  %}
                        {% set class = loop.last and loop.length == 2 ? 'flex-1 relative flex justify-end' : 'w-full ' %}
                    {% elseif loop.last and loop.length == 2 and renderStyle == 'flex' %}
                        {% set class = 'flex-1 relative flex justify-end' %}
                    {% else %}
                        {% set class = loop.last and loop.length > 2 ? 'flex-1' : 'flex-grow' %}
                    {% endif %}

                    {% if renderStyle == 'table' and element.isInstanceOf('Gibbon\\Forms\\Layout\\Label') %}
                        {% set class = class ~ " lg:w-2/5" %}
                    {% endif %}


                    {% set hasClass = element.instanceOf('Gibbon\\Forms\\Layout\\Element') or element.instanceOf('Gibbon\\Forms\\Layout\\Row') %}
                    <div class="{{ class }} {{ hasClass ? element.getClass : '' }}" {{ colspan ? 'colspan="%s"'|format(colspan)|raw }}>
                        {{ element.getOutput|raw }}

                        {% if element.instanceOf('Gibbon\\Forms\\ValidatableInterface') %}
                        <script type="text/javascript">
                            {{ element.getValidationOutput|raw }}
                        </script>
                        {% endif %}
                    </div>
                {% endfor %}

                </div>
            {% endfor %}

            {% if "sticky" not in (rows|first).class and "blank" not in form.getClass %}
            </div>
            {% endif %}

        {% endfor %}

        </div>

        {% if metaSidebar  %}

        <aside class="hidden 2xl:block col-span-2 h-min bg-gray-50 rounded border border-gray-400 border-t-4 border-t-gray-400">
            
            <div class="px-6 py-4 border-b">
                <label for="lessonDetailsTemplate" class="font-medium mt-4 sm:my-0 text-base/7 sm:text-sm/6 text-gray-800 ">Test Field</label> 

            </div>
            <div class="px-6 py-4 border-b">
                <label for="lessonDetailsTemplate" class="font-medium mt-4 sm:my-0 text-base/7 sm:text-sm/6 text-gray-800 ">Created On</label> 
            </div>
            <div class="px-6 py-4 ">
                <label for="lessonDetailsTemplate" class="font-medium mt-4 sm:my-0 text-base/7 sm:text-sm/6 text-gray-800 ">Last Modified</label>
            </div>

        </aside>
        {% endif %}

    </section>
    {% endif %}

    {% if postScript %}
    <p>{{ postScript|raw }}</p>
    {% endif %}

    <script type="text/javascript">
        {% for code in javascript %}
            {{ code|raw }}
        {% endfor %}
    </script>

{% if form.getAction %}
</form>
{% endif %}
