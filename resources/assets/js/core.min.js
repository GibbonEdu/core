jQuery(function(o){o(document).on("click","[data-toggle]",function(){var e=o(this).data("toggle");o(e).hasClass("hidden")?(o(e).removeClass("hidden"),o(this).addClass("active")):(o(e).addClass("hidden"),o(this).removeClass("active"))}),o("#sidebarToggle").click(function(){o("#sidebar").hasClass("lg:w-sidebar")?(o("#sidebar").removeClass("lg:w-sidebar"),o("#sidebar").addClass("lg:hidden"),o(this).html("«")):(o("#sidebar").removeClass("lg:hidden"),o("#sidebar").addClass("lg:w-sidebar"),o(this).html("»"))}),o(document).on("click",'.checkall[type="checkbox"]',function(){var e=this,n=e.checked;e.closest("fieldset, .bulkActionForm").querySelectorAll('input[type="checkbox"]').forEach(function(t,a,i){if(t!==e){t.checked=n;let e=t.closest("tr");null!=e&&e.classList.toggle("selected",t.checked),a==i.length-1&&o(t).trigger("change")}})}),o(document).on("click, change",".bulkActionForm .bulkCheckbox :checkbox",function(){var e,t,a=o(this).parents(".bulkActionForm").find(".bulkCheckbox :checkbox"),i=a.filter(":checked").length;0<i?o(".bulkActionPanel").hasClass("hidden")&&(o(".bulkActionPanel").removeClass("hidden"),e=o(this).parents(".bulkActionForm").find(".dataTable header"),t=o(".bulkActionPanel").innerHeight(),o(".bulkActionCount span").html(i),o(".bulkActionPanel").css("top",e.outerHeight(!1)-t+6),o(".bulkActionPanel :input").trigger("showhide")):o(".bulkActionPanel").addClass("hidden"),o(".checkall").prop("checked",0<i),o(".checkall").prop("indeterminate",0<i&&i<a.length),o(this).closest("tr").toggleClass("selected",o(this).prop("checked"))}),document.querySelectorAll('.bulkCheckbox input[type="checkbox"]').forEach(function(e){e.closest("tr").classList.toggle("selected",e.checked)});var e=o(".columnHighlight td");e.on("mouseover",function(){e.filter(":nth-child("+(o(this).index()+1)+")").addClass("hover")}).on("mouseout",function(){e.removeClass("hover")}),o(".generatePassword").click(function(){if(""!=o(this).data("source")&&""!=o(this).data("confirm")){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789![]{}()%&*$#^~@|",t="",a=0;a<12;a++)t+=e.charAt(0==a?Math.floor(26*Math.random()):1==a?Math.floor(26*Math.random())+26:2==a?Math.floor(10*Math.random())+52:3==a?Math.floor(19*Math.random())+62:Math.floor(Math.random()*e.length));o('input[name="'+o(this).data("source")+'"]').val(t).blur(),o('input[name="'+o(this).data("confirm")+'"]').val(t).blur(),prompt(o(this).data("alert"),t)}}),o(".generateUsername").click(function(){var t=o(this).data("alert");o.ajax({type:"POST",data:{gibbonRoleID:o("#gibbonRoleIDPrimary").val(),preferredName:o("#preferredName").val(),firstName:o("#firstName").val(),surname:o("#surname").val()},url:"./modules/User Admin/user_manage_usernameAjax.php",success:function(e){0==e?(o("#gibbonRoleIDPrimary").change(),o("#preferredName").blur(),o("#firstName").blur(),o("#surname").blur(),alert(t)):(o("#username").val(e),o("#username").trigger("input"),o("#username").blur())}})}),o(".colorPicker").each(function(){var e=this,t=o(e).data("for");o(e).change(function(){o("#"+t).val(o(this).val())}),o("#"+t).on("input",function(){o(e).val(o(this).val())})}),o(".dataTable table[data-drag-url]").each(DraggableDataTable),o(document).on("click",".dataTable .expander",function(){o(this).toggleClass("expanded"),o(this).parent().closest("tr").next("tr").toggle()}),o(document).on("change",".auto-submit",function(){o(this).parents("form").submit()})});var DraggableDataTable=function(){var t=this;$("tbody",t).sortable({placeholder:"drag-placeholder bg-gray-400 shadow-inner",handle:".drag-handle",start:function(e,t){$(t.placeholder).children("td").each(function(){$(this).outerHeight($(t.item).outerHeight())})},update:function(){var e=new Array;$(".draggable",this).each(function(){e.push($(this).data("drag-id"))}),$.ajax({url:$(t).data("drag-url"),data:{data:$(t).data("drag-data"),order:JSON.stringify(e)},type:"POST",success:function(e){}})}}).disableSelection()};function updateComments(e){var t=$(e).val(),a=t.length;$(".characterInfo .currentLength",$(e).parent()).html(a);a=$(e).data("name")?$(e).data("name"):"";0<a.length&&(i=-1===t.indexOf(a),$(".characterInfo .commentStatusName",$(e).parent()).toggleClass("hidden",!i));var i,a=$(e).data("gender")?$(e).data("gender"):"";0<a.length&&(i=-1!==t.search(/\bhe\b/i)||-1!==t.search(/\bhis\b/i)||-1!==t.search(/\bhim\b/i)||-1!==t.search(/\bhimself\b/i),t=-1!==t.search(/\bshe\b/i)||-1!==t.search(/\bher\b/i)||-1!==t.search(/\bherself\b/i),a=i&&"F"==a||t&&"M"==a,$(".characterInfo .commentStatusPronoun",$(e).parent()).toggleClass("hidden",!a))}function updatePlaceholders(e){var t=$(e).val(),a=$(e).data("name")?$(e).data("name"):"";0<a.length&&(t=t.replace(/{name}/gi,a));a=$(e).data("gender")?$(e).data("gender"):"";0<a.length&&("F"==a?t=(t=(t=(t=t.replace(/\bhe\b/g,"she").replace(/\bHe\b/g,"She")).replace(/\bhis\b/g,"her").replace(/\bHis\b/g,"Her")).replace(/\bhim\b/g,"her").replace(/\bHim\b/g,"Her")).replace(/\bhimself\b/g,"herself").replace(/\bHimself\b/g,"Herself"):"M"==a&&(t=(t=(t=t.replace(/\bshe\b/g,"he").replace(/\bShe\b/g,"He")).replace(/\bher\b/g,"his").replace(/\bHer\b/g,"His")).replace(/\bherself\b/g,"himself").replace(/\bHerself\b/g,"Himself"))),$(e).val(t)}$.prototype.gibbonCommentEditor=function(e){var t=this;updateComments(t),$(t).on("input",function(){updateComments(this)}),$(t).on("paste",function(){var e=this;setTimeout(function(){updatePlaceholders(e),updateComments(e)},0)}),$(t).ready(function(){autosize(t)})},$.prototype.gibbonUniquenessCheck=function(t){var a,i=this;$(i).ready(function(){null!=(a=window["lv"+$(i).attr("id")+"Validate"])&&"object"==typeof a||(a=new LiveValidation($(i).attr("id"))),a.onValid=function(){t.ajaxData[t.ajaxData.fieldName||"value"]=$(i).val(),$.ajax({type:"POST",data:t.ajaxData,url:t.ajaxURL,success:function(e){e<0?(a.message=a.invalidMessage=t.alertError,a.validationFailed=!0):0==e?(a.message=a.validMessage=t.alertSuccess,a.validationFailed=!1):0<e&&(a.message=a.invalidMessage=t.alertFailure,a.validationFailed=!0,a.add(Validate.Exclusion,{within:[$(i).val()],failureMessage:t.alertFailure})),a.insertMessage(a.createMessageSpan()),a.addFieldClass()}})}})};var CustomBlocks=window.CustomBlocks||{},CustomBlocks=function(e,t){var a=this;a.container=$(e),a.blockTemplate=$(".blockTemplate",e),a.blockCount=0,a.identifiers=[],a.validation=[],a.defaults={inputNameStrategy:"object",addSelector:".addBlock",addOnEvent:"click",deleteMessage:"Delete?",duplicateMessage:"Duplicate",animationSpeed:600,currentBlocks:[],predefinedBlocks:[],preventDuplicates:!1,sortable:!1,orderName:"order"},a.settings=$.extend({},a.defaults,t),a.init()};CustomBlocks.prototype.init=function(){var e,a=this;for(e in $(a.settings.addSelector,a.container).each(function(){$(this).on(a.settings.addOnEvent,function(){var e,t=$(this).val();t&&(a.settings.preventDuplicates&&a.identifiers.includes(t)?alert(a.settings.duplicateMessage):((e=a.settings.predefinedBlocks[t]||{}).identifier=t,a.addBlock(e),a.identifiers.push(t)))})}),a.settings.sortable&&($(".blocks",a.container).sortable({placeholder:"sortHighlight",handle:".sortHandle"}).bind("sortstart",function(e,t){$(a.container).trigger("hideAll"),$("textarea.tinymce",a.container).each(function(e,t){tinymce.EditorManager.execCommand("mceRemoveEditor",!1,$(this).prop("id"))})}),$(a.blockTemplate).prepend('<div class="sortHandle floatLeft"></div>')),$(".showHide",a.blockTemplate).hide(),$(":input",a.blockTemplate).prop("disabled",!0),a.settings.currentBlocks)a.addBlock(a.settings.currentBlocks[e]),a.identifiers.push(e);$(a.container).on("delete",function(e,t){confirm(a.settings.deleteMessage)&&a.removeBlock(t)}).on("showHide",function(e,t,a){$(a).hasClass("showHidden")?($(a).removeClass("showHidden"),$("img",a).prop("src",$(a).data("off")),t.find(".showHide").hide()):($(a).addClass("showHidden"),$("img",a).prop("src",$(a).data("on")),t.find(".showHide").show(),$("textarea.tinymce",t).each(function(e,t){tinymce.EditorManager.execCommand("mceAddEditor",!1,$(this).prop("id"))}))}).on("hideAll",function(e,t,a){$(".showHide").hide(),$('a.blockButton[data-event="showHide"]').each(function(e,t){$(t).removeClass("showHidden"),$("img",t).prop("src",$(t).data("off"))})}),a.refresh()},CustomBlocks.prototype.addBlock=function(e){var t=this;t.blockCount++;var a=$(t.blockTemplate).clone().css("display","block").appendTo($(".blocks",t.container));$(a).append('<input type="hidden" name="'+t.settings.orderName+'[]" value="'+t.blockCount+'" />'),t.initBlock(a,e),t.refresh(),$(t.container).trigger("addedBlock",[a])},CustomBlocks.prototype.removeBlock=function(e){var t=this;t.blockCount--;var a=t.identifiers.indexOf(e.identifier);-1!==a&&t.identifiers.splice(a,1),t.removeBlockValidation(e),$(e).fadeOut(t.settings.animationSpeed,function(){$(e).detach().remove(),t.refresh()}),$(t.container).trigger("removedBlock",[e])},CustomBlocks.prototype.initBlock=function(e,t){var a=this;e.blockNumber=a.blockCount,e.identifier=t.identifier,a.loadBlockInputData(e,t),a.renameBlockFields(e),a.addBlockValidation(e),a.addBlockEvents(e)},CustomBlocks.prototype.loadBlockInputData=function(t,e){for(key in $(":input",t).prop("disabled",!1),e)$("[name='"+key+"']:not([type='file']):not([type='radio']):not([type='checkbox'])",t).val(e[key]),$("input:radio[name='"+key+"']",t).each(function(){$(this).val()==e[key]&&$(this).attr("checked",!0)}),$("input:checkbox[name='"+key+"'],input:checkbox[name='"+key+"[]']",t).each(function(){(Array.isArray(e[key])?e[key]:e[key].split(",")).includes($(this).val())&&$(this).attr("checked",!0)});(e.readonly||[]).forEach(function(e){$("[name='"+e+"']",t).prop("readonly",!0).addClass("readonly"),$("select[name='"+e+"'] option:not(:selected)",t).prop("disabled",!0)})},CustomBlocks.prototype.renameBlockFields=function(i){var n=this;$("input, textarea, select",i).each(function(e,t){if($(this).prop("name")!=n.settings.orderName+"[]"){var a;switch(n.settings.inputNameStrategy){case"object":a=$(n.container).prop("id")+"["+i.blockNumber+"]["+$(this).prop("name")+"]";break;case"array":a=$(this).prop("name")+"["+i.blockNumber+"]";break;case"string":a=$(this).prop("name")+i.blockNumber}a=a.replace("[]]","][]"),$(this).prop("name",a),""!=$(this).prop("id")&&$(this).prop("id",$(this).prop("id")+i.blockNumber)}}),$("label",i).each(function(e,t){$(this).prop("for",$(this).prop("for")+i.blockNumber)}),$("textarea[data-tinymce]",i).each(function(e,t){var i=$(this).is(":hidden"),n={id:$(this).prop("id"),value:$(this).val(),showMedia:$(this).data("media"),rows:$(this).attr("rows")};$(this).parent().load("./modules/Planner/planner_editorAjax.php",n,function(e,t,a){i||tinymce.EditorManager.execCommand("mceAddEditor",!1,n.id)})})},CustomBlocks.prototype.addBlockValidation=function(block){var _=this;$("input, textarea, select",block).each(function(index,element){var id;$(this).data("validation")&&!$(this).prop("readonly")&&(id=$(this).prop("id"),eval("block."+id+"Validate = new LiveValidation('"+id+"', {});"),$(this).data("validation").forEach(function(item){eval("block."+id+"Validate.add("+item.type+", {"+item.params+"});")}))})},CustomBlocks.prototype.removeBlockValidation=function(block){var _=this;$("input, textarea, select",block).each(function(index,element){var id;$(this).data("validation")&&!$(this).prop("readonly")&&(id=$(this).prop("id"),eval("block."+id+"Validate.destroy();"))}),$("textarea.tinymce",block).each(function(e,t){tinymce.EditorManager.execCommand("mceRemoveEditor",!1,$(this).prop("id"))})},CustomBlocks.prototype.addBlockEvents=function(a){var i=this;$("a.blockButton",a).each(function(e,t){$(t).click(function(e){e.preventDefault(),$(i.container).trigger($(this).data("event"),[a,this])})})},CustomBlocks.prototype.refresh=function(){var e=this;$(".blockCount",e.container).val(e.blockCount),$(".blockPlaceholder",e.container).css("display",0<e.blockCount?"none":"block"),$("select.addBlock",e.container).val("")},$.prototype.gibbonCustomBlocks=function(e){this.gibbonCustomBlocks=new CustomBlocks(this,e),this.data("gibbonCustomBlocks",this.gibbonCustomBlocks)};var DataTable=window.DataTable||{},DataTable=function(e,t,a,i){var n=this;n.table=$(e),n.path=t+" #"+$(e).attr("id")+" > .dataTable",n.filters=a,n.identifier=i,0==n.filters.sortBy.length&&(n.filters.sortBy={}),0==n.filters.filterBy.length&&(n.filters.filterBy={}),n.init()};DataTable.prototype.init=function(){var a=this;$(a.table).on("click",".paginate",function(){var e=$(".dataTable",a.table).data("results");a.filters.pageMax=Math.ceil(e/a.filters.pageSize),a.filters.page=Math.min($(this).data("page"),a.filters.pageMax),a.refresh()}),$(a.table).on("click",".column.sortable",function(e){var t=$(this).data("sort").split(",");0!=t.filter(function(e){return e in a.filters.sortBy}).length||e.shiftKey||(a.filters.sortBy={}),t.forEach(function(e){a.filters.sortBy[e]="ASC"==a.filters.sortBy[e]?"DESC":"ASC"}),a.refresh()}),$(a.table).on("click",".filter",function(){var e=$(this).data("filter");$(this).hasClass("clear")?(a.filters.filterBy={"":""},a.filters.searchBy.columns=[""]):e in a.filters.filterBy&&("in"==e&&(a.filters.searchBy.columns=[""]),delete a.filters.filterBy[e]),jQuery.isEmptyObject(a.filters.filterBy)&&(a.filters.filterBy={"":""}),a.filters.page=1,a.refresh()}),$(a.table).on("change",".filters",function(){var e=$(this).val().split(":"),t=e[0],e=e[1];a.filters.filterBy[t]=e,a.filters.page=1,a.refresh()}),$(a.table).on("change",".limit",function(){var e=$(".dataTable",a.table).data("results");a.filters.pageSize=parseInt($(this).val()),a.filters.pageMax=Math.ceil(e/a.filters.pageSize),a.filters.page=Math.min(a.filters.page,a.filters.pageMax),a.refresh()})},DataTable.prototype.refresh=function(){var e=this,i=setTimeout(function(){$(".pagination",e.table).prepend('<span class="submitted"></span>')},500),t={};""!=e.identifier?t[e.identifier]=e.filters:t=e.filters,$(e.table).load(e.path,t,function(e,t,a){$(".bulkActionPanel").addClass("hidden"),tb_init("a.thickbox"),clearTimeout(i)})},$.prototype.gibbonDataTable=function(e,t,a){this.gibbonDataTable=new DataTable(this,e,t,a)};var MultiSelect=window.MultiSelect||{};function gibbonFormSubmitted(e){var t=$('input[type="submit"]',$(e));t.prop("disabled",!0),($(e).hasClass("standardForm")||$(e).hasClass("formTable"))&&setTimeout(function(){t.wrap('<span class="submitted"></span>')},500)}function debounce(t,a){var i;return a=a||300,function(){clearTimeout(i);var e=arguments;i=setTimeout(function(){t.apply(this,e)},a)}}MultiSelect=function(e,t){var a=this;a.container=$(e),a.selectSource=$("#"+t+"Source",e),a.selectDestination=$("#"+t,e),a.name=t,a.sortBy=$("#"+t+"Sort",e),a.init()},MultiSelect.prototype.init=function(){var e=this;$("#"+e.name+"Add").click(function(){e.transferOption(!0)}),$("#"+e.name+"Remove",e.container).click(function(){e.transferOption(!1)});var t=e.container.parents("form");$("input[type='Submit']",t).click(function(){$("option",e.selectDestination).each(function(){$(this).prop("selected",!0)})}),e.sortBy.change(function(){e.sortSelects()}),$("#"+e.name+"Search",e.container).keyup(function(){var t=$(this).val().toLowerCase();$("option",e.selectSource).each(function(){var e=$(this);e.text().toLowerCase().includes(t)?e.show():e.hide()})})},MultiSelect.prototype.transferOption=function(e){var t=this,a=e?t.selectSource:t.selectDestination,i=e?t.selectDestination:t.selectSource;a.find("option:selected").each(function(){var e,t=$(this).clone();$(this).parent().is("optgroup")?(0==(e=$("optgroup[label='"+$(this).parent().attr("label")+"']",i)).length&&(e=$(this).parent().clone().html(""),i.append(e)),t.data("parent",e),e.append(t)):i.append(t),$(this).detach().remove()}),t.sortSelects(),i.change().focus()},MultiSelect.prototype.sortSelects=function(){var e=this,t=null,a=null;0!==e.sortBy.length&&(a=e.sortBy.val()),null!=a&&"Sort by Name"!=a&&(t=e.container.data("sortable")[a]),e.sortSelect(e.selectSource,t),e.sortSelect(e.selectDestination,t)},MultiSelect.prototype.sortSelect=function(e,a){var t=this;$("optgroup",e).each(function(){t.sortSelect($(this),a)});var i=$("option",e);e.is("select")&&(i=i.not("optgroup option")),null==a&&(a={});var n=i.map(function(e,t){return{tSort:a[t.value]+$(t).text(),t:$(t).text(),v:t.value}}).get();n.sort(function(e,t){return e.tSort>t.tSort?1:e.tSort<t.tSort?-1:0}),i.each(function(e,t){t.value=n[e].v,$(t).text(n[e].t)})},$.prototype.gibbonMultiSelect=function(e){this.gibbonMultiSelect=new MultiSelect(this,e)};var __GIBBON_URL_DEBOUNCE_MAP={};function gibbonFormSubmitQuiet(e,t){e=$(e).serialize();__GIBBON_URL_DEBOUNCE_MAP[t]||(__GIBBON_URL_DEBOUNCE_MAP[t]=debounce(function(e){$.ajax({type:"POST",data:e,url:t})})),__GIBBON_URL_DEBOUNCE_MAP[t](e)}