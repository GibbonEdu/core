jQuery(function(e){e(document).on("click","[data-toggle]",function(){var t=e(this).data("toggle");e(t).hasClass("hidden")?(e(t).removeClass("hidden"),e(this).addClass("active")):(e(t).addClass("hidden"),e(this).removeClass("active"))}),e(document).on("click",".checkall",function(){e(this).closest("table").find(":checkbox").attr("checked",e(this).prop("checked")).trigger("change")}),e(document).on("click, change",".bulkActionForm .bulkCheckbox :checkbox",function(){var t=e(this).parents(".bulkActionForm").find(".bulkCheckbox :checkbox"),a=t.filter(":checked").length;if(a>0){e(".bulkActionPanel").removeClass("hidden");var i=e(this).parents(".bulkActionForm").find(".dataTable header"),o=e(".bulkActionPanel").innerHeight();e(".bulkActionCount span").html(a),e(".bulkActionPanel").css("top",i.outerHeight(!1)-o+6),e(".bulkActionPanel :input").trigger("showhide")}else e(".bulkActionPanel").addClass("hidden");e(".checkall").prop("checked",a>0),e(".checkall").prop("indeterminate",a>0&&a<t.length),e(this).closest("tr").toggleClass("selected",e(this).prop("checked"))}),e(".bulkActionForm").find(".bulkCheckbox :checkbox").each(function(){e(this).closest("tr").toggleClass("selected",e(this).prop("checked"))});var t=e(".columnHighlight td");t.on("mouseover",function(){t.filter(":nth-child("+(e(this).index()+1)+")").addClass("hover")}).on("mouseout",function(){t.removeClass("hover")}),e(".generatePassword").click(function(){if(""!=e(this).data("source")&&""!=e(this).data("confirm")){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789![]{}()%&*$#^~@|",a="",i=0;i<12;i++)a+=t.charAt(0==i?Math.floor(26*Math.random()):1==i?Math.floor(26*Math.random())+26:2==i?Math.floor(10*Math.random())+52:3==i?Math.floor(19*Math.random())+62:Math.floor(Math.random()*t.length));e('input[name="'+e(this).data("source")+'"]').val(a).blur(),e('input[name="'+e(this).data("confirm")+'"]').val(a).blur(),prompt(e(this).data("alert"),a)}}),e(".generateUsername").click(function(){var t=e(this).data("alert");e.ajax({type:"POST",data:{gibbonRoleID:e("#gibbonRoleIDPrimary").val(),preferredName:e("#preferredName").val(),firstName:e("#firstName").val(),surname:e("#surname").val()},url:"./modules/User Admin/user_manage_usernameAjax.php",success:function(a){0==a?(e("#gibbonRoleIDPrimary").change(),e("#preferredName").blur(),e("#firstName").blur(),e("#surname").blur(),alert(t)):(e("#username").val(a),e("#username").trigger("input"),e("#username").blur())}})})}),$.prototype.gibbonUniquenessCheck=function(e){var t,a=this;$(a).ready(function(){null!=(t=window["lv"+$(a).attr("id")+"Validate"])&&"object"==typeof t||(t=new LiveValidation($(a).attr("id"))),t.onValid=function(){e.ajaxData[e.ajaxData.fieldName||"value"]=$(a).val(),$.ajax({type:"POST",data:e.ajaxData,url:e.ajaxURL,success:function(i){i<0?(t.message=t.invalidMessage=e.alertError,t.validationFailed=!0):0==i?(t.message=t.validMessage=e.alertSuccess,t.validationFailed=!1):i>0&&(t.message=t.invalidMessage=e.alertFailure,t.validationFailed=!0,t.add(Validate.Exclusion,{within:[$(a).val()],failureMessage:e.alertFailure})),t.insertMessage(t.createMessageSpan()),t.addFieldClass()}})}})};var CustomBlocks=window.CustomBlocks||{};CustomBlocks=function(e,t){var a=this;a.container=$(e),a.blockTemplate=$(".blockTemplate",e),a.blockCount=0,a.identifiers=[],a.validation=[],a.defaults={inputNameStrategy:"object",addSelector:".addBlock",addOnEvent:"click",deleteMessage:"Delete?",duplicateMessage:"Duplicate",animationSpeed:600,currentBlocks:[],predefinedBlocks:[],preventDuplicates:!1,sortable:!1,orderName:"order"},a.settings=$.extend({},a.defaults,t),a.init()},CustomBlocks.prototype.init=function(){var e=this;for(var t in $(e.settings.addSelector,e.container).each(function(){$(this).on(e.settings.addOnEvent,function(){var t=$(this).val();if(t)if(e.settings.preventDuplicates&&e.identifiers.includes(t))alert(e.settings.duplicateMessage);else{var a=e.settings.predefinedBlocks[t]||{};a.identifier=t,e.addBlock(a),e.identifiers.push(t)}})}),e.settings.sortable&&($(".blocks",e.container).sortable({placeholder:"sortHighlight",handle:".sortHandle"}).bind("sortstart",function(t,a){$(e.container).trigger("hideAll"),$("textarea.tinymce",e.container).each(function(e,t){tinymce.EditorManager.execCommand("mceRemoveEditor",!1,$(this).prop("id"))})}),$(e.blockTemplate).prepend('<div class="sortHandle floatLeft"></div>')),$(".showHide",e.blockTemplate).hide(),$(":input",e.blockTemplate).prop("disabled",!0),e.settings.currentBlocks)e.addBlock(e.settings.currentBlocks[t]);$(e.container).on("delete",function(t,a){confirm(e.settings.deleteMessage)&&e.removeBlock(a)}).on("showHide",function(t,a,i){$(i).hasClass("showHidden")?($(i).removeClass("showHidden"),$("img",i).prop("src",$(i).data("off")),a.find(".showHide").hide()):($(i).addClass("showHidden"),$("img",i).prop("src",$(i).data("on")),a.find(".showHide").show(),$("textarea.tinymce",e.container).each(function(e,t){tinymce.EditorManager.execCommand("mceAddEditor",!1,$(this).prop("id"))}))}).on("hideAll",function(e,t,a){$(".showHide").hide(),$('a.blockButton[data-event="showHide"]').each(function(e,t){$(t).removeClass("showHidden"),$("img",t).prop("src",$(t).data("off"))})}),e.refresh()},CustomBlocks.prototype.addBlock=function(e){var t=this;t.blockCount++;var a=$(t.blockTemplate).clone().css("display","block").appendTo($(".blocks",t.container));$(a).append('<input type="hidden" name="'+t.settings.orderName+'[]" value="'+t.blockCount+'" />'),t.initBlock(a,e),t.refresh(),$(t.container).trigger("addedBlock",[a])},CustomBlocks.prototype.removeBlock=function(e){var t=this;t.blockCount--;var a=t.identifiers.indexOf(e.identifier);-1!==a&&t.identifiers.splice(a,1),t.removeBlockValidation(e),$(e).fadeOut(t.settings.animationSpeed,function(){$(e).detach().remove(),t.refresh()}),$(t.container).trigger("removedBlock",[e])},CustomBlocks.prototype.initBlock=function(e,t){var a=this;e.blockNumber=a.blockCount,e.identifier=t.identifier,a.loadBlockInputData(e,t),a.renameBlockFields(e),a.addBlockValidation(e),a.addBlockEvents(e)},CustomBlocks.prototype.loadBlockInputData=function(e,t){for(key in $(":input",e).prop("disabled",!1),t)$("[name='"+key+"']:not([type='file'])",e).val(t[key]),$("label[for='"+key+"']",e).html(t[key]);(t.readonly||[]).forEach(function(t){$("[name='"+t+"']",e).prop("readonly",!0).addClass("readonly"),$("select[name='"+t+"'] option:not(:selected)",e).prop("disabled",!0)})},CustomBlocks.prototype.renameBlockFields=function(e){var t=this;$("input, textarea, select",e).each(function(a,i){if($(this).prop("name")!=t.settings.orderName+"[]"){var o;switch(t.settings.inputNameStrategy){case"object":o=$(t.container).prop("id")+"["+e.blockNumber+"]["+$(this).prop("name")+"]";break;case"array":o=$(this).prop("name")+"["+e.blockNumber+"]";break;case"string":o=$(this).prop("name")+e.blockNumber}$(this).prop("name",o),""!=$(this).prop("id")&&$(this).prop("id",$(this).prop("id")+e.blockNumber)}}),$("label",e).each(function(t,a){$(this).prop("for",$(this).prop("for")+e.blockNumber)}),$("textarea.tinymce",e).each(function(e,t){var a={id:$(this).prop("id"),value:$(this).val()};$(this).parent().load("./modules/Planner/planner_add_editorAjax.php",a,function(e,t,i){tinymce.EditorManager.execCommand("mceAddEditor",!1,a.id)})})},CustomBlocks.prototype.addBlockValidation=function(block){var _=this;$("input, textarea, select",block).each(function(index,element){if($(this).data("validation")&&!$(this).prop("readonly")){var id=$(this).prop("id");eval("block."+id+"Validate = new LiveValidation('"+id+"', {});"),$(this).data("validation").forEach(function(item){eval("block."+id+"Validate.add("+item.type+", {"+item.params+"});")})}})},CustomBlocks.prototype.removeBlockValidation=function(block){var _=this;$("input, textarea, select",block).each(function(index,element){if($(this).data("validation")&&!$(this).prop("readonly")){var id=$(this).prop("id");eval("block."+id+"Validate.destroy();")}}),$("textarea.tinymce",block).each(function(e,t){tinymce.EditorManager.execCommand("mceRemoveEditor",!1,$(this).prop("id"))})},CustomBlocks.prototype.addBlockEvents=function(e){var t=this;$("a.blockButton",e).each(function(a,i){$(i).click(function(a){a.preventDefault(),$(t.container).trigger($(this).data("event"),[e,this])})})},CustomBlocks.prototype.refresh=function(){var e=this;$(".blockCount",e.container).val(e.blockCount),$(".blockPlaceholder",e.container).css("display",e.blockCount>0?"none":"block"),$("select.addBlock",e.container).val("")},$.prototype.gibbonCustomBlocks=function(e){this.gibbonCustomBlocks=new CustomBlocks(this,e)};var DataTable=window.DataTable||{};function gibbonFormSubmitted(e){var t=$('input[type="submit"]',$(e));t.prop("disabled",!0),$(e).hasClass("standardForm")&&setTimeout(function(){t.wrap('<span class="submitted"></span>')},500)}DataTable=function(e,t,a,i){var o=this;o.table=$(e),o.path=t+" #"+$(e).attr("id")+" .dataTable",o.filters=a,o.identifier=i,0==o.filters.sortBy.length&&(o.filters.sortBy={}),0==o.filters.filterBy.length&&(o.filters.filterBy={}),o.init()},DataTable.prototype.init=function(){var e=this;$(e.table).on("click",".paginate",function(){var t=$(".dataTable",e.table).data("results");e.filters.pageMax=Math.ceil(t/e.filters.pageSize),e.filters.page=Math.min($(this).data("page"),e.filters.pageMax),e.refresh()}),$(e.table).on("click",".column.sortable",function(t){var a=$(this).data("sort").split(",");0!=a.filter(function(t){return t in e.filters.sortBy}).length||t.shiftKey||(e.filters.sortBy={}),a.forEach(function(t){e.filters.sortBy[t]="ASC"==e.filters.sortBy[t]?"DESC":"ASC"}),e.refresh()}),$(e.table).on("click",".filter",function(){var t=$(this).data("filter");$(this).hasClass("clear")?(e.filters.filterBy={"":""},e.filters.searchBy.columns=[""]):t in e.filters.filterBy&&("in"==t&&(e.filters.searchBy.columns=[""]),delete e.filters.filterBy[t]),jQuery.isEmptyObject(e.filters.filterBy)&&(e.filters.filterBy={"":""}),e.filters.page=1,e.refresh()}),$(e.table).on("change",".filters",function(){var t=$(this).val().split(":"),a=t[0],i=t[1];e.filters.filterBy[a]=i,e.filters.page=1,e.refresh()}),$(e.table).on("change",".limit",function(){var t=$(".dataTable",e.table).data("results");e.filters.pageSize=parseInt($(this).val()),e.filters.pageMax=Math.ceil(t/e.filters.pageSize),e.filters.page=Math.min(e.filters.page,e.filters.pageMax),e.refresh()}),$(e.table).on("click",".expander",function(){$(this).toggleClass("expanded"),$(this).parents("tr").next("tr").toggle()})},DataTable.prototype.refresh=function(){var e=this,t=setTimeout(function(){$(".pagination",e.table).prepend('<span class="submitted"></span>')},500),a={};""!=e.identifier?a[e.identifier]=e.filters:a=e.filters,$(e.table).load(e.path,a,function(e,a,i){$(".bulkActionPanel").addClass("hidden"),tb_init("a.thickbox"),clearTimeout(t)})},$.prototype.gibbonDataTable=function(e,t,a){this.gibbonDataTable=new DataTable(this,e,t,a)};
